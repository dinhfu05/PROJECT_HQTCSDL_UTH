================================================================================
                            LISTING MODULE
================================================================================

================================================================================
                      PRODUCT vs LISTING - KHÃI NIá»†M
================================================================================

PRODUCT (Sáº£n pháº©m):
-------------------
â€¢ 1 sáº£n pháº©m trong database
â€¢ VÃ­ dá»¥: iPhone 15 vá»›i giÃ¡ 25 triá»‡u, mÃ´ táº£, hÃ¬nh áº£nh...

LISTING (Danh sÃ¡ch sáº£n pháº©m):
-----------------------------
â€¢ Hiá»ƒn thá»‹ NHIá»€U products cÃ¹ng lÃºc
â€¢ CÃ³ filter (lá»c theo danh má»¥c, giÃ¡)
â€¢ CÃ³ sort (sáº¯p xáº¿p theo giÃ¡, bÃ¡n cháº¡y)
â€¢ CÃ³ pagination (phÃ¢n trang)

VÃ Dá»¤ THá»°C Táº¾ (TIKI/SHOPEE):
-----------------------------

LISTING - Trang danh má»¥c (nhiá»u sáº£n pháº©m)     PRODUCT - Trang chi tiáº¿t (1 sáº£n pháº©m)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /products?categoryId=1             â”‚       â”‚  /products/123                      â”‚
â”‚                                     â”‚       â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”       â”‚       â”‚  ğŸ“± iPhone 15 Pro Max               â”‚
â”‚  â”‚ğŸ“±  â”‚ â”‚ğŸ“±  â”‚ â”‚ğŸ“±  â”‚ â”‚ğŸ“±  â”‚       â”‚       â”‚                                     â”‚
â”‚  â”‚25trâ”‚ â”‚22trâ”‚ â”‚15trâ”‚ â”‚8tr â”‚  ...  â”‚  â”€â”€â”€â–º â”‚  GiÃ¡: 34,990,000Ä‘                   â”‚
â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜       â”‚ Click â”‚  â­ 4.9 (2,345 Ä‘Ã¡nh giÃ¡)            â”‚
â”‚                                     â”‚       â”‚  MÃ´ táº£ chi tiáº¿t...                  â”‚
â”‚  [1] [2] [3] ... [100]              â”‚       â”‚  [Mua ngay]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cáº¤U TRÃšC TRONG CODE:
--------------------
products/
â”œâ”€â”€ listing/           â† LISTING: GET /products (nhiá»u sp, filter, sort, phÃ¢n trang)
â””â”€â”€ repositories/      â† PRODUCT: GET /products/:id, POST, PATCH, DELETE (1 sp)

Táº I SAO TÃCH LISTING RIÃŠNG?
---------------------------
â€¢ Listing pháº£i xá»­ lÃ½ 1 TRIá»†U records â†’ cáº§n optimize
â€¢ CÃ³ filter/sort/pagination phá»©c táº¡p
â€¢ ÄÃ¢y lÃ  nÆ¡i CHáº¬M NHáº¤T náº¿u khÃ´ng optimize!
â€¢ Má»¥c Ä‘Ã­ch: BENCHMARK PERFORMANCE

================================================================================
                              Má»¤C ÄÃCH
================================================================================

Hot path cho benchmark performance - nÆ¡i táº­p trung filter/sort/pagination.
ÄÃ¢y lÃ  module QUAN TRá»ŒNG NHáº¤T Ä‘á»ƒ so sÃ¡nh <1M vs 1M records.

================================================================================
                          CHI TIáº¾T Tá»ªNG FILE
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. listing.types.ts - TypeScript Interfaces                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Äá»‹nh nghÄ©a cÃ¡c kiá»ƒu dá»¯ liá»‡u cho module listing:                          â”‚
â”‚                                                                            â”‚
â”‚  â€¢ ListingQueryParams                                                      â”‚
â”‚    - cursor, limit (pagination)                                            â”‚
â”‚    - categoryId, minPrice, maxPrice, search, inStock (filtering)           â”‚
â”‚    - sortBy, sortOrder (sorting)                                           â”‚
â”‚                                                                            â”‚
â”‚  â€¢ ListingResult<T>                                                        â”‚
â”‚    - data: T[] (danh sÃ¡ch sáº£n pháº©m)                                        â”‚
â”‚    - nextCursor, hasMore (pagination info)                                 â”‚
â”‚    - perf: { db_ms, total_ms } â† ThÃ´ng tin performance                     â”‚
â”‚                                                                            â”‚
â”‚  â€¢ ProductListingItem                                                      â”‚
â”‚    - Dá»¯ liá»‡u sáº£n pháº©m cho listing (id, name, price, category...)           â”‚
â”‚                                                                            â”‚
â”‚  â€¢ CursorData                                                              â”‚
â”‚    - Dá»¯ liá»‡u encode trong cursor (id + sortValue)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. listing.query.ts - Query Parser & SQL Builder                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Class: ListingQuery                                                       â”‚
â”‚                                                                            â”‚
â”‚  Constructor nháº­n query params tá»« request vÃ  parse thÃ nh typed object.     â”‚
â”‚                                                                            â”‚
â”‚  Methods:                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ parseQuery()           â”‚ Parse raw query â†’ ListingQueryParams      â”‚   â”‚
â”‚  â”‚ parseSortBy()          â”‚ Validate sortBy, default 'created_at'     â”‚   â”‚
â”‚  â”‚ buildWhereClause()     â”‚ Táº¡o WHERE sql + values cho filters        â”‚   â”‚
â”‚  â”‚ buildOrderByClause()   â”‚ Táº¡o ORDER BY sql                          â”‚   â”‚
â”‚  â”‚ decodeCursor()         â”‚ Decode base64 cursor â†’ CursorData         â”‚   â”‚
â”‚  â”‚ buildCursorCondition() â”‚ Táº¡o cursor condition cho pagination       â”‚   â”‚
â”‚  â”‚ getLimit()             â”‚ Tráº£ vá» limit (max 100)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                            â”‚
â”‚  LÆ¯U Ã:                                                                    â”‚
â”‚  - Cursor-based pagination NHANH hÆ¡n offset-based vá»›i data lá»›n            â”‚
â”‚  - Composite cursor (sortValue + id) Ä‘áº£m báº£o stable pagination            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. listing.repo.ts - Repository Layer (Raw SQL)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Class: ListingRepo                                                        â”‚
â”‚                                                                            â”‚
â”‚  TÆ°Æ¡ng tÃ¡c trá»±c tiáº¿p vá»›i MySQL, ÄO THá»œI GIAN db_ms.                       â”‚
â”‚                                                                            â”‚
â”‚  Methods:                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ findProducts(query)     â”‚ SELECT vá»›i filter/sort/pagination        â”‚   â”‚
â”‚  â”‚                         â”‚ â†’ Tráº£ vá» { products, db_ms }             â”‚   â”‚
â”‚  â”‚                         â”‚ â†’ DÃ™NG process.hrtime.bigint() Ä‘o time   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ countTotal(query)       â”‚ COUNT(*) - CHáº¬M vá»›i 1M records!          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ explainQuery(query)     â”‚ EXPLAIN - xem query plan                 â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ explainAnalyzeQuery()   â”‚ EXPLAIN ANALYZE - Ä‘o actual performance  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                            â”‚
â”‚  SQL Structure (index-friendly):                                           â”‚
â”‚    SELECT ... FROM products p                                              â”‚
â”‚    LEFT JOIN categories c ON p.category_id = c.id                          â”‚
â”‚    WHERE [filters]                                                         â”‚
â”‚    AND [cursor_condition]                                                  â”‚
â”‚    ORDER BY [sort]                                                         â”‚
â”‚    LIMIT ?                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. listing.service.ts - Business Logic Layer                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Class: ListingService                                                     â”‚
â”‚                                                                            â”‚
â”‚  Xá»­ lÃ½ business logic, ÄO THá»œI GIAN total_ms.                             â”‚
â”‚                                                                            â”‚
â”‚  Methods:                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ getProducts()           â”‚ Main listing - tráº£ vá» ListingResult      â”‚   â”‚
â”‚  â”‚                         â”‚ - Gá»i repo.findProducts()                â”‚   â”‚
â”‚  â”‚                         â”‚ - Check hasMore (láº¥y N+1, return N)      â”‚   â”‚
â”‚  â”‚                         â”‚ - Encode nextCursor                      â”‚   â”‚
â”‚  â”‚                         â”‚ - TÃ­nh perf { db_ms, total_ms }          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ getProductsWithCount()  â”‚ Listing + COUNT (cháº­m hÆ¡n!)              â”‚   â”‚
â”‚  â”‚                         â”‚ - Cháº¡y parallel Promise.all              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ explainQuery()          â”‚ Wrapper cho repo.explainQuery            â”‚   â”‚
â”‚  â”‚ explainAnalyzeQuery()   â”‚ Wrapper cho repo.explainAnalyzeQuery     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ encodeCursor()          â”‚ Encode lastItem â†’ base64 cursor string   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                            â”‚
â”‚  Flow: Controller â†’ Service â†’ Repo â†’ Database                              â”‚
â”‚        â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ perf data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. listing.controller.ts - HTTP Endpoints                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Express Router vá»›i 4 endpoints:                                           â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GET /products             â”‚ Main listing (filter/sort/pagination)   â”‚  â”‚
â”‚  â”‚                           â”‚ â†’ { success, data, nextCursor, perf }   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ GET /products/with-count  â”‚ Listing + total count                   â”‚  â”‚
â”‚  â”‚                           â”‚ â†’ { ...above, total }                   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ GET /products/explain     â”‚ Debug query plan                        â”‚  â”‚
â”‚  â”‚                           â”‚ â†’ { success, explain, query }           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ GET /products/explain-    â”‚ Detailed performance analysis           â”‚  â”‚
â”‚  â”‚ analyze                   â”‚ â†’ { success, analyze, query }           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  Error Handling: try-catch vá»›i 500 status                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. index.ts - Module Exports                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Export táº¥t cáº£ public APIs:                                                â”‚
â”‚  - listingController (Router)                                              â”‚
â”‚  - listingService                                                          â”‚
â”‚  - ListingQuery class                                                      â”‚
â”‚  - Types: ListingResult, ProductListingItem, etc.                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
                            API ENDPOINTS
================================================================================

GET /products
  Query params:
  - cursor: string         (pagination)
  - limit: number          (default 20, max 100)
  - categoryId: number     (filter)
  - minPrice: number       (filter)
  - maxPrice: number       (filter)
  - search: string         (filter)
  - sortBy: price|created_at|name|sales_count
  - sortOrder: asc|desc

GET /products/with-count
  Same as above + returns total count (slower)

GET /products/explain
  Debug query plan (EXPLAIN)

GET /products/explain-analyze
  Detailed performance analysis (EXPLAIN ANALYZE)

================================================================================
                         RESPONSE FORMAT
================================================================================

{
  "success": true,
  "data": [...],
  "nextCursor": "abc123...",
  "hasMore": true,
  "perf": {
    "db_ms": 45.23,    â† Thá»i gian query MySQL
    "total_ms": 52.10  â† Tá»•ng thá»i gian request
  }
}

================================================================================
                         DATA FLOW DIAGRAM
================================================================================

  HTTP Request
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller     â”‚  â† Nháº­n request, gá»i service
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Service       â”‚  â† Parse query, Ä‘o total_ms
â”‚                  â”‚  â† Encode cursor
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Repository     â”‚  â† Build SQL, Ä‘o db_ms
â”‚                  â”‚  â† Execute query
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  MySQL    â”‚  â† SELECT vá»›i index
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
                         BENCHMARK WORKFLOW
================================================================================

1. Seed 10k records  â†’ Query â†’ Ghi nháº­n db_ms
2. Seed 100k records â†’ Query â†’ Ghi nháº­n db_ms
3. Seed 1M records   â†’ Query â†’ Ghi nháº­n db_ms (CHáº¬M!)
4. ThÃªm indexes      â†’ Query â†’ Ghi nháº­n db_ms (NHANH!)
5. So sÃ¡nh káº¿t quáº£ trÃªn FE

================================================================================
                         PERFORMANCE TIPS
================================================================================

1. Cursor > Offset
   - OFFSET 900000 LIMIT 20 â†’ pháº£i scan 900k rows!
   - WHERE id > 900000 LIMIT 20 â†’ chá»‰ scan 20 rows

2. Index columns Ä‘Æ°á»£c filter/sort
   - CREATE INDEX idx_category ON products(category_id)
   - CREATE INDEX idx_price ON products(price)
   - CREATE INDEX idx_created ON products(created_at)

3. Avoid COUNT(*) vá»›i data lá»›n
   - DÃ¹ng /products (khÃ´ng cÃ³ count) khi cÃ³ thá»ƒ
   - Cache total count

4. EXPLAIN Ä‘á»ƒ debug
   - type: ALL â†’ Full table scan (BAD!)
   - type: ref â†’ Using index (GOOD!)

================================================================================
